---
- name: Retrieve Kubeconfig & IP
  hosts: all
  gather_facts: no
  vars:
    k8s_model: "k8s-cluster-02" # 預設值，會被 Survey 覆蓋

  tasks:
    - name: 1. Get Node Public IPv4
      # 查詢機器的 IPv4，方便您等一下替換 IP
      command: "juju ssh -m {{ k8s_model }} microk8s/0 -- ip -4 addr"
      register: node_ip

    - name: 2. Get Raw Kubeconfig
      # 抓取原始設定檔
      command: "juju ssh -m {{ k8s_model }} microk8s/0 -- sudo microk8s config"
      register: kubeconfig_raw

    - name: 3. Display Results
      debug:
        msg: 
          - "========================================================"
          - "【請複製以下資訊】"
          - "--------------------------------------------------------"
          - "建議使用的連線 IP (請從下方列表尋找 192.168.x.x):"
          - "{{ node_ip.stdout_lines }}"
          - "--------------------------------------------------------"
          - "原始 Kubeconfig 內容 (請複製並修改 server IP):"
          - "{{ kubeconfig_raw.stdout_lines }}"
          - "========================================================"
